{
  "hash": "5243dd7049622c298686216f650892e5",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"The recipe to debug your R code in VSCode\"\nauthor: \"Yohann Mansiaux\"\ncategories: [debug, vscode, development]\nimage: \"image.jpg\"\n---\n\n\n\nDebugging code in an everyday (often painful) task for developers. In a recent video, I presented [how to debug R code in RStudio IDE](https://www.youtube.com/watch?v=WB5e8P2KHhI).\n\nTwo native functions available natively in R were shown : `browser()` and `debugonce()`. They are very useful to debug your code.\n\n- `debugonce()` is a function that allows you to debug a function the next time it is called. It is useful when you want to debug a function without modifying its code.\n- `browser()` is a function that allows you to pause the execution of your code at a specific point and enter the debugging environment. It is useful when you want to inspect the state of your code at a specific point in time.\n\nWe are going to show you how to use these functions in VSCode, as well as introducing \"breakpoints\". Breakpoints are markers that you can set in your code to pause execution at a specific line. This allows you to inspect the state of your code at that point and step through it line by line. They are very close to the `browser()` function. They can also be used in RStudio IDE, but I have to admit that I never used them.\n\n**Important: this blog post assumes that you have a functional setup of VSCode for using R.**\n\nIf you don't have it yet, I recommend you to check out the following ressources:\n\n- [vscode-r github](https://github.com/REditorSupport/vscode-R)\n- [R Programming in Visual Studio Code](https://www.datanovia.com/learn/tools/r-in-vscode/)\n\n\n# The R package to be debugged\n\nWe will be working with a [very simple toy package called `{epidemiofuns}`](https://github.com/ymansiaux/debugvscodepkg). This package contains two functions meant to be used in epidemiology.\n\nThe first one is `calculate_rr_in_df()`:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncalculate_rr_in_df <- function(\n    df,\n    column_cases_exposed = \"cases_exposed\",\n    column_total_exposed = \"total_exposed\",\n    column_cases_unexposed = \"cases_unexposed\",\n    column_total_unexposed = \"total_unexposed\") {\n  risk1 <- compute_risk(df[, column_cases_exposed], df[, column_total_exposed])\n  risk2 <- compute_risk(df[, column_cases_unexposed], df[, column_total_unexposed])\n  df <- df %>%\n    mutate(\n      rr = risk1 / risk2\n    )\n  return(df)\n}\n```\n:::\n\n\n\nThis function calculates the relative risk (RR) from a data frame containing counts of cases and total individuals in both exposed and unexposed groups. It is calling another function `compute_risk()`. This function is not the main focus of this post, but it is a simple function that calculates the risk from two vectors.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncompute_risk <- function(cases, total) {\n  results <- cases / total\n  return(results)\n}\n```\n:::\n\n\n\n# Debugging code in the R terminal\n\nBefore showing you how to use the specific VSCode debugger, let's see how to debug the code in the R terminal.\n\nIn the same way as in RStudio, you can use the `debugonce()` function to debug the `calculate_rr_in_df()` function. However, the little toolbar you've been used to will have disappeared. \nYou'll need to use keyboard shortcuts to move on the debugging your code. \n\nHere are the keyboard shortcuts you'll need to debug your code in VSCode's R terminal:\n\n![](img/raccourcis_clavier_debug_rstudio.png)\n\nOnce you've got these shortcuts in your head (or on a reminder next to you!), you can start debugging your code !\n\nTo be able to use my function easily, I have added in the package a toy dataset called `toy_dataset`.\n\n\n\n{{< video img/01_debug_old_school.mp4 >}}\n\n\n\n\nI didn't show the usage of the `browser()` function in the video, but the way to process is the same.\n\nAs you can see, this way to debug your code is not user-friendly. You have to remember the shortcuts, and you don't have the nice toolbar you are used to in RStudio.\n\nNow let's move to the VSCode-specific debugger, to see if it's a more fun way to explore our code !\n\n\n# The VSCode debugger\n\n## Prerequisites\n\nBefore we start, make sure you have the following prerequisites:\n\n- Having installed the [R package `{vscDebugger}`](https://github.com/ManuelHentschel/vscDebugger): \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nremotes::install_github(\"ManuelHentschel/vscDebugger\")\n```\n:::\n\n\n \n\n- Having installed the VSCode extension [R Debugger](https://marketplace.visualstudio.com/items?itemName=RDebugger.r-debugger).\n\n\n## Launch a debugging session\n\nLaunching a debugging session is very easy. You just have to click on the \"Run and Debug\" icon in the left menu of VSCode, and then select \"R Debugger\".\n\nSince we are working with a R package, we need to select the \"Debug R-Package\" option. This will launch a debugging session in the context of the package, i.e a call to the function `pkgload::load_all()` will be made, ensuring the sourcing of all functions in our environment.\nIf we are working with a script, we can select the \"Debug R-File\" option.\n\n\n\n{{< video img/02_open_debugger.mp4 >}}\n\n\n\n\n\n## Use breakpoints\n\nBreakpoints are markers that you can set in your code to pause execution at a specific line. This allows you to inspect the state of your code at that point and step through it line by line. Adding a breaking point is very easy. You just have to click on the left margin of the line you want to set a breakpoint on. A red dot will appear, indicating that a breakpoint has been set.\nThis is equivalent of adding a `browser()` function in your code.\n\n**Important note:** the breakpoints are not saved in your code. They are only set in the context of the debugging session. This means that if you close the debugging session, the breakpoints will be removed. This is different from the `browser()` function, which is saved in your code !\n\nOnce your debugging session is launched, you can see that the color of the bottom bar has changed. Moreover, a new specific terminal has been opened, called \"DEBUG CONSOLE\". This is where you can see the output of your code, and where you can enter commands to inspect the state of your code. Previously, we working in the classical R terminal, because we were not using the specific VSCode debugging tool.\n\n\n\n{{< video img/03_breakpoints.mp4 >}}\n\n\n\n\nThis way to debug your code is much more user-friendly than the previous one. You can see the state of your code at any point, and you can step through it line by line. You can also inspect the variables in your code, and see their values.\nBreakpoints are very easy to use, and not intrusive as the use of `browser()` can be. This feature, coupled to the use of the command palette, make the debugging process easier.\n\nIf you are lost between the use of the RStudio command palette and the VSCode command palette, below is a correspondence between the two:\n\n![](img/equivalence_vscode_rstudio.png)\n\n\n## Use `debugonce()` and `browser()`\n\nUsing the `debugonce()` and `browser()` functions in VSCode is very similar to using them in RStudio. You can use them in the same way, and they will work as expected.\n\n\n\n{{< video img/04_debugonce_browser.mp4 >}}\n\n\n\n\n## Displaying data.frames and plots in the Debug Console\n\nWhen you are debugging your code, you can display data.frames and plots in the Debug Console. This is very useful to inspect the state of your code at a specific point.\n\nNatively, data.frames are displayed in a very compact way, which is not very user-friendly. However, like shown in a previous video, you can right-click on the data.frame on the \"Variables\" panel, and select \"Show in Data Viewer\". \n\n![](img/data_viewer.png)\n\nOn my VSCode (I'm working on Windows 11), data.frames and plots were not opened by default in my current VSCode window. I had to edit the `RProfile` file to add the following:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nif (Sys.getenv(\"VSCODE_DEBUG_SESSION\") == \"1\") {\n    Sys.setenv(TERM_PROGRAM = \"vscode\")\n    source(file.path(Sys.getenv(if (.Platform$OS.type == \"windows\") \"USERPROFILE\" else \"HOME\"), \".vscode-R\", \"init.R\"))\n}\n```\n:::\n\n\n\nTo have access to the `RProfile` file, you can run `usethis::edit_r_profile()` in the R console. This will open the `RProfile` file in your default editor. You can then add the code above to the file, and save it (your session must be restarted to use it). \n\n\n# Conclusion\n\nThe experience of R programming in VSCode has grown remarkably robust in recent years. While debugging was previously a key advantage of RStudio, the R Debugger extension has effectively closed that gap.\n\nWhen comparing the two IDEs specifically for debugging:\n- **VSCode** offers an elegant visual debugging experience with intuitive breakpoints and a clean variable inspection panel\n- **RStudio** provides a more integrated experience but with essentially the same core functionality\n\nFor those considering a switch from RStudio to VSCode, the debugging workflow should no longer be a concern. Both environments now offer powerful tools for stepping through your code and identifying bugs efficiently.\n\nSetting up the debugging environment in VSCode takes only about 5-10 minutes for most users, and the productivity gains are well worth the initial configuration time.\n\nI hope this blog post helps make your debugging process less stressful and more productive! If you have additional VSCode debugging tips or questions, feel free to reach out to me.\n\nHappy debugging!",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}